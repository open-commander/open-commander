http_port 3128

# Log to stdout for Docker
access_log stdio:/dev/stdout
cache_log /dev/stdout
pid_filename /tmp/squid.pid
coredump_dir /tmp

# Minimal caching on tmpfs to satisfy Squid requirements
cache deny all
cache_store_log none
cache_mem 0
cache_dir ufs /tmp/squid 16 16 256

# Allowlist ACLs
acl allowed_domains dstdomain "/etc/squid/allowed-domains.txt"
acl allowed_ips dst "/etc/squid/allowed-ips.txt"

# Safe ports
acl SSL_ports port 443
acl Safe_ports port 80 443
acl CONNECT method CONNECT

# Block unsafe ports
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

# Allow only explicitly allowed destinations
http_access allow allowed_domains
http_access allow allowed_ips

# Deny everything else
http_access deny all
